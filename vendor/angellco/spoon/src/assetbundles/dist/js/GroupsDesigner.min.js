!function(o){"undefined"==typeof Spoon&&(Spoon={}),Spoon.GroupsDesigner=Craft.FieldLayoutDesigner.extend({$form:null,$spinner:null,modal:null,initField:function(t){var e=t.find(".settings"),i=o('<div class="menu" data-align="center"/>').insertAfter(e),a=o("<ul/>").appendTo(i);o('<li><a data-action="edit-field-layout">'+Craft.t("spoon","Edit field layout")+"</a></li>").appendTo(a),o('<li><a data-action="remove">'+Craft.t("app","Remove")+"</a></li>").appendTo(a),new Garnish.MenuBtn(e,{onOptionSelect:o.proxy(this,"onFieldOptionSelect")})},onFieldOptionSelect:function(t){var e=o(t),i=e.data("menu").$anchor.parent();switch(e.data("action")){case"edit-field-layout":this.onEditFieldLayout(i);break;case"remove":this.removeField(i)}},renameTab:function(t){if(this.settings.customizableTabs){var e=t.find(".tabs .tab span"),i=e.text(),a=prompt(Craft.t("spoon","Give your group a name."),i);a&&a!=i&&(e.text(a),t.find(".id-input").attr("name",this.getFieldInputName(a)))}},addTab:function(){if(this.settings.customizableTabs){var t=o('<div class="fld-tab"><div class="tabs"><div class="tab sel draggable"><span>'+Craft.t("app","Group")+" "+(this.tabGrid.$items.length+1)+'</span><a class="settings icon" title="'+Craft.t("app","Rename")+'"></a></div></div><div class="fld-tabcontent"></div></div>').appendTo(this.$tabContainer);this.tabGrid.addItems(t),this.tabDrag.addItems(t),this.initTab(t)}},onEditFieldLayout:function(t){var e=t.parents(".modal");e.one("blockTypesSaved",o.proxy(function(){this.editFieldLayout(t)},this)),e.trigger("submit")},editFieldLayout:function(e){this.$form=o('<form class="modal elementselectormodal spoon-fields-configurator"/>');var i=o('<div class="body"/>').appendTo(this.$form),a=(i=o('<div class="content"/>').appendTo(i),o('<div class="spinner big"/>').appendTo(i)),t=(i=o('<div class="main"/>').appendTo(i),o('<div class="footer"/>').appendTo(this.$form)),n=o('<div class="buttons right"/>').appendTo(t);this.$spinner=o('<div class="spinner hidden"/>').appendTo(n);var s=o('<div class="btn">'+Craft.t("app","Cancel")+"</div>").appendTo(n);o('<input type="submit" class="btn submit" value="'+Craft.t("app","Save")+'"/>').appendTo(n);this.modal=new Garnish.Modal(this.$form,{resizable:!0,closeOtherModals:!1,onFadeIn:o.proxy(function(){var t={context:this.settings.context,blockTypeId:e.data("id")};Craft.postActionRequest("spoon/configurator/get-fields-html",t,o.proxy(function(t,e){if("success"==e){o(t.html).appendTo(i),a.addClass("hidden");new Spoon.BlockTypeFieldLayoutDesigner("#spoon-fields-configurator",{fieldInputName:"blockTypeFieldLayouts[__TAB_NAME__][]"})}},this))},this),onHide:o.proxy(function(){this.modal.$container.remove(),this.modal.$shade.remove()},this)}),this.addListener(this.$form,"submit","_handleSubmit"),this.addListener(s,"click",o.proxy(function(){this.modal.hide()},this))},_handleSubmit:function(t){t.preventDefault(),this.$spinner.removeClass("hidden");var e=this.$form.serialize();Craft.postActionRequest("spoon/block-types/save-field-layout",e,o.proxy(function(t,e){this.$spinner.addClass("hidden"),"success"==e&&t.success?(Craft.cp.displayNotice(Craft.t("app","Field layout saved.")),this.modal.hide()):"success"==e&&Craft.cp.displayError(Craft.t("app","An unknown error occurred."))},this))}})}(jQuery);