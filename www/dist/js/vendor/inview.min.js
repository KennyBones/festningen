/**
 * author Remy Sharp
 * url http://remysharp.com/2009/01/26/element-in-view-event-plugin/
 */
$.fn.inview = function() {
    console.log(this);
    var $elems = this;



    function getViewportHeight() {
        var height = window.innerHeight; // Safari, Opera
        var mode = document.compatMode;

        if ( (mode || !$.support.boxModel) ) { // IE, Gecko
            height = (mode == 'CSS1Compat') ?
            document.documentElement.clientHeight : // Standards
            document.body.clientHeight; // Quirks
        }

        return height;
    }

    var vpH = getViewportHeight(),
        scrolltop = (document.documentElement.scrollTop ?
            document.documentElement.scrollTop :
            document.body.scrollTop);

    var eleInView;

    $elems.each(function () {
        var $el = $(this),
            top = $el.offset().top,
            height = $el.height() - (vpH / 1.5),
            inview = $el.data('inview') || false;

        if (scrolltop > (top + height) || scrolltop + vpH < top) {
            if (inview) {
                $el.data('inview', false);
                eleInView = false;
                return true;
            }
        } else if (scrolltop < (top + height)) {
            if (!inview) {
                $el.data('inview', true);
                eleInView = $el;
                return false;
            }
        }
    });

    return eleInView;
};
